# Go 架构实践

Q: 总结限流，熔断，降级的常用方式，重试的注意事项，负载均衡的常用方式。

## 限流

限流常用于由于服务处理能力不够或处理速度较慢从而无法处理高并发请求时，对接口进行限速限流，可以有单机点限流，动态限流和分布式限流。

- 单节点限流实现相对简单，稳定性和性能高，但是相对死板，集群扩缩容时需要手动去修改阈值，而且会出现因为流量不均导致误限流情况。

- 动态限流是根据机器的实时处理能力和负载来动态的限流，不需要手动配置。但是需要收集服务和集群的各项指标才能达到动态的限流。

- 分布式限流更加公平不会因为流量不均导致误限流，集群机器扩缩容也不影响限流，但是实现相对麻烦复杂。


## 熔断

熔断常用于服务接口超时的情况下，防止服务长期挂起从而对请求进行fail fast的操作。这样可以保证某个服务或接口临时不可用时不会因为源源不断的请求进来从而把服务直接搞死的场景。

## 降级

常用于在在bff层因为某些接口或服务不可用从而拿不到数据时，对这错误进行处理然后返回一些默认数据或空数据的方式，确保对外的整个数据是可用的，只是某些不太重要的数据暂时无法获取。如评论系统的用户信息，文章系统的点赞收藏数量等。

## 重试需要注意事项

- 在失败层进行重新，并把重试的标识传递给上一层
- 指定重试次数和策略 不要无脑重试
- 进行一定的随机化，不要给下游服务带来放大的请求量

## 负载均衡常用的方式

- bff调用下层服务，通过负载均衡策略拿到可用且健康的节点
- 下层服务之间相互调用是 同样也是通过负载均衡拿到节点在进行调用
- grpc调用时 通过grpc的load balancer 来请求到对呀服务的节点
